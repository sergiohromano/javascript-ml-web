<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="description" content="Astro description"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.15.10"><title>Javascript Modern Life</title><style>:root{--accent: 136, 58, 234;--accent-light: 224, 204, 250;--accent-dark: 49, 10, 101;--accent-gradient: linear-gradient( 45deg, rgb(var(--accent)), rgb(var(--accent-light)) 30%, white 60% )}html{font-family:system-ui,sans-serif;background:#13151a;background-size:224px}code{font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace}main[data-astro-cid-j7pv25f6]{margin:auto;padding:1.5rem;max-width:60ch}form[data-astro-cid-j7pv25f6]{color:#fff;padding:2rem;display:flex;align-items:center;justify-content:space-between;background-color:#23262d;background-image:none;background-size:400%;border-radius:.6rem;background-position:100%;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -2px #0000001a}button[data-astro-cid-j7pv25f6]{appearance:none;border:0;font-weight:500;border-radius:5px;font-size:.875rem;padding:.5rem .75rem;background-color:#fff;border:1px solid rgb(var(--accent));color:rgb(var(--accent))}button[data-astro-cid-j7pv25f6]:active:enabled{background-color:#eee}section[data-astro-cid-j7pv25f6]{margin-top:2rem;background-color:#d6d6d6;border-radius:20px;padding:10px}ul[data-astro-cid-j7pv25f6]{list-style:none;padding:0}li[data-astro-cid-j7pv25f6]{padding:1rem;border-bottom:1px solid #333}ul[data-astro-cid-j7pv25f6] li[data-astro-cid-j7pv25f6]{gap:.5rem}section[data-astro-cid-j7pv25f6] h2[data-astro-cid-j7pv25f6]{color:#180d2a}
</style></head> <body>  <main data-astro-cid-j7pv25f6> <form action="https://apiminio.rcodefs.com/sergioromano-bucket/c326b9d9-6e4c-43b3-af7a-25a129da08f3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=tyuiXrwaZl9b1tO1NBMa%2F20241003%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20241003T175951Z&X-Amz-Expires=1000&X-Amz-SignedHeaders=host&X-Amz-Signature=8b4ff635507878fec317bb43c4e6b98719d7995b29c38b532192e2daa7df3ee3" data-astro-cid-j7pv25f6> <input name="file" type="file" accept="image/png, image/jpeg" data-astro-cid-j7pv25f6> <button type="submit" data-astro-cid-j7pv25f6>Upload</button> </form> <section class="" data-astro-cid-j7pv25f6> <h2 data-astro-cid-j7pv25f6>Documents</h2> <ul id="list" data-astro-cid-j7pv25f6></ul> </section> <script>(function(){const docUuid = "c326b9d9-6e4c-43b3-af7a-25a129da08f3";
const apiUrl = "https://jsml-sergioromano-jsmlsergioromanoopenapiworkerscript.sergiohromano.workers.dev";

      const webSocketClient = new WebSocket(apiUrl.replace("https", "wss").replace("http", "ws") + '/ws');

      webSocketClient.onmessage = (event) => {
        console.log(event.data);
        setTimeout(() => window.location.reload(), 1000);
      };

      const form = document.querySelector("form");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const file = form.file.files?.[0];

        const image = await fetch(form.action, {
          body: file,
          method: "PUT",
          headers: {
            "Content-Type": file.type,
            "Content-Disposition": `attachment; filename="${file.name}"`,
          },
        });

        if (!image.ok) {
          throw new Error("Failed to upload image");
        }

        const doc = await fetch(`${apiUrl}/api/documents`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            mode: "no-cors"
          },
          body: JSON.stringify({ 
            name: file.name,
            document: docUuid,
          })
        });
        if (!doc.ok) {
          throw new Error("Failed to upload image");
        }

        console.log("ID", await doc.json());
        webSocketClient.send("Document uploaded. Refreshing...");
      });

      fetch(`${apiUrl}/api/documents`, {
  headers: {
    "Content-Type": "application/json",
    mode: "no-cors"
  }
      }).then(async (res) =>  {
          const documents = await res.json();
          documents.forEach((doc) => {
            const li = document.createElement("li");
            li.innerHTML = `
              <li data-id="${doc.id}">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M6 17h12l-3.75-5l-3 4L9 13zm-3 4V3h18v18z"></path></svg><span>${doc.name}</span>
              </li>`;
            document.getElementById("list").appendChild(li);
          });

      }


        );

    })();</script> </main>  </body></html> 